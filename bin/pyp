#!/bin/bash

help(){
echo "Valid Commands are:"
echo "host     start the host"
echo "hostb    start the host in the background"
echo "client   start the client"
echo "bad      start the bad client (sends bad data to host)"
echo "list     lists all of the files"
echo "drop     deletes all of the game save files"
echo "dc       sends a shut down to the host"
echo "rrm      removes all pyc files"
echo "setup    sets up the bashrc (must source ~/.bashrc afterwards)"
echo "djr      runs the django web server"
echo "djrr     restarts the django web server"
echo "djs      generates the django static files"
echo "web      runs the web server"
echo "webfull  runs the backend server and the web server"
echo "rfile f  resets the file's access and modify time to 1 day ago"
}

if [ $# == 1 ]; then
	if [ $1 == host ]; then
		cd $pyp/src/host
		python host.py
	elif [ $1 == hostb ]; then
		cd $pyp/src/host
		python host.py &
	elif [ $1 == client ]; then
		cd $pyp/src/client
		python client.py
	elif [ $1 == drop ]; then
		cd $pyp/src/host
		python host.py c
	elif [ $1 == list ]; then
		cd $pyp
		find *
	elif [ $1 == bad ]; then
		cd $pyp/src/client
		python client.py b
	elif [ $1 == dc ]; then
		cd $pyp/src/client
		python client.py d
	elif [ $1 == pyc ]; then
		cd $pyp
		find . -name "*.pyc" | xargs rm
	elif [ $1 == djr ]; then
		cd $pyp/web
		./manage.py runserver 0.0.0.0:8080
	elif [ $1 == djrs ]; then
		kill $(netstat -tupln | grep 8080 | grep -o "[0-9]*/python" | grep -o "[0-9]*")
	elif [ $1 == djs ]; then
		cd $pyp/web
		./manage.py collectstatic
	elif [ $1 == web ]; then
		cd $pyp/tmp/hand_crafted_web
		python -B index.py
	elif [ $1 == webfull ]; then
		cd $pyp/src/host
		python host.py&
		sleep .5
		cd $pyp/tmp/hand_crafted_web
		python index.py
	elif [ $1 == setup ]; then
		echo "" >> ~/.bashrc
		echo "# Postprompt Setup" >> ~/.bashrc
		echo "" >> ~/.bashrc
		echo "export pyp=`pwd`" >> ~/.bashrc
		echo "export pyproot=\$pyp/root" >> ~/.bashrc
		echo "export PATH=\$PATH:\$pyp/bin" >> ~/.bashrc
		echo "export PYTHONPATH=\$pyp/src/share" >> ~/.bashrc
		echo "alias cdpyp=\"cd \$pyp\"" >> ~/.bashrc
		echo "alias cdpypr=\"cd \$pyproot\"" >> ~/.bashrc
		echo "run 'source ~/.bashrc' to have this take effect"
	elif [ $1 == "--help" ]; then
		help
	else
		help
	fi
elif [ $# == 2 ]; then
	if [ $1 == rfile ]; then
		touch -r $2 -d '-1 day' $2
		touch -r $2 --time=mtime -d '-1 day' $2
	fi
else
	echo "Starting server in background and client in foreground!"
	cd $pyp/src/host
	python host.py&
	sleep .5
	cd $pyp/src/client
	python client.py
fi
